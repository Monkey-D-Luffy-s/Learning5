@model Learning5.Models.Account.Holiday

@{
    ViewData["Title"] = "Manage Holidays";
}

<div class="container bg-black text-white rounded-2 m-4 p-4">
    <h3 class="text-center">Add New Holiday</h3>
    <form id="holidayForm" class="mb-4">
        <div class="row">
            <div class=" col-md-4 mb-3">
                <label for="holidayDate" class="form-label">Holiday Date</label>
                <input type="date" class="form-control" id="holidayDate" onclick="this.showPicker()" onfocus="this.showPicker()" required />
            </div>
            <div class="col-md-4 mb-3">
                <label for="holidayName" class="form-label">Holiday Name</label>
                <input type="text" class="form-control" id="holidayName" required />
            </div>
            <div class="col-md-4">
                <button type="submit" class="btn btn-primary">Add Holiday</button>
            </div>
        </div>
    </form>

    <h3>Existing Holidays</h3>
    <table class="table table-striped bg-black text-white mb-4">
        <thead>
            <tr>
                <th>Date</th>
                <th>Name</th>
            </tr>
        </thead>
        <tbody id="holidaysTable">
        </tbody>
    </table>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        loadHolidays();

        document.getElementById("holidayForm").addEventListener("submit", function (e) {
            e.preventDefault();
            var date = document.getElementById("holidayDate").value;
            var name = document.getElementById("holidayName").value;

            $.ajax({
                url: '@Url.Action("AddHoliday", "Account")',
                type: 'POST',
                data: { date: date, name: name },
                success: function () {
                    document.getElementById("holidayForm").reset();
                    loadHolidays();
                },
                error: function (xhr) {
                    
                }
            });
        });

        function loadHolidays() {
            $.ajax({
                url: '@Url.Action("GetHolidaysList", "Account")',
                type: 'GET',
                success: function (response) {
                    var tbody = document.getElementById("holidaysTable");
                    tbody.innerHTML = '';
                    if (Array.isArray(response.value)) {
                        response.value.forEach(holiday => {
                            var row = `<tr>
                                <td>${holiday.date}</td>
                                <td>${holiday.name}</td>
                            </tr>`;
                            tbody.innerHTML += row;
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching holidays:", error);
                }
            });
        }
    });
</script>